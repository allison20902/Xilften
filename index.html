<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xilften</title>
    <!-- Inclui Tailwind CSS para um estilo rápido e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* VARIÁVEIS CSS para fácil personalização */
        :root {
            --cor-bg-dark: #000;
            --cor-text-dark: #fff;
            --cor-accent: #e50914; /* Vermelho Netflix */
            --cor-accent-hover: #b20710; /* Vermelho mais escuro no hover */
            --cor-accent-disabled: #770000;
            --cor-header-bg: #1a1a1a; /* Cinza escuro para o cabeçalho */
            font-size: 16px; /* Base para 1rem, ajustada em media queries */
        }

        /* ESTILOS GLOBAIS E RESETS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', Arial, sans-serif; /* Usando Inter para um visual moderno */
        }
        body {
            background-color: var(--cor-bg-dark); /* Fundo padrão do body é preto */
            color: var(--cor-text-dark);
            overflow: hidden; /* O body não deve rolar, as telas individuais rolam */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* Contexto para as telas absolutas */
            width: 100vw;
        }

        /* CLASSES PARA CONTROLE DE TELAS PRINCIPAIS */
        .tela-principal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            min-height: 100vh;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
        }

        .tela-principal.ativa {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }

        /* TELA DE LOGIN */
        #telaLogin {
            background: url('https://wallpapers.com/images/hd/american-movie-posters-z0puq43u0qbtr6j2.webp') no-repeat center center;
            background-size: cover;
            z-index: 100;
        }

        #loginBox {
            background-color: rgba(0, 0, 0, 0.85);
            padding: 1.5rem 2rem; /* Reduzido para ser menor */
            border-radius: 0.625rem; /* 10px */
            min-width: 18rem; /* Reduzido */
            box-shadow: 0 0 0.9375rem 0.1875rem var(--cor-accent); /* 15px 3px */
            user-select: none;
            text-align: center;
        }

        #loginBox h1 {
            font-size: 3.75rem; /* 60px */
            margin-bottom: 1.25rem; /* 20px */
            font-weight: bold;
            color: var(--cor-accent);
            user-select: none;
        }

        .campo {
            margin: 0.75rem auto; /* 12px */
            width: fit-content;
        }
        input[type="text"], input[type="password"] {
            padding: 0.625rem; /* 10px */
            width: 12.5rem; /* Reduzido para caber melhor na caixa menor */
            border: none;
            border-radius: 0.3125rem; /* 5px */
            font-size: 1rem; /* 16px */
            outline-offset: 0.125rem; /* 2px */
            outline-color: var(--cor-accent);
            background-color: #222;
            color: white;
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        input[type="text"]:focus, input[type="password"]:focus {
            outline-color: #ff4444;
        }

        #btnEntrar {
            display: block;
            width: 100%;
            padding: 0.625rem 1.875rem; /* 10px 30px */
            background-color: var(--cor-accent);
            color: white;
            font-size: 1rem; /* 16px */
            border: none;
            border-radius: 0.3125rem; /* 5px */
            margin-top: 1.5625rem; /* 25px */
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background-color 0.3s ease;
            user-select: none;
            min-height: 3rem; /* Altura mínima para toque */
        }
        #btnEntrar:hover:not(:disabled) {
            background-color: var(--cor-accent-hover);
        }
        #btnEntrar:disabled {
            background-color: var(--cor-accent-disabled);
            cursor: default;
        }

        .erro, .modal-erro {
            color: #ff4444;
            margin-top: 0.625rem; /* 10px */
            min-height: 1.25rem; /* 20px */
            font-weight: bold;
            font-size: 0.875rem; /* 14px */
            user-select: none;
        }

        /* TELA DE PERFIS */
        #telaPerfis {
            background-color: var(--cor-bg-dark); /* Fundo PRETO */
            z-index: 90;
        }

        #containerPerfis {
            display: flex;
            gap: 1.875rem; /* 30px */
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1.875rem; /* 30px */
            background-color: rgba(0, 0, 0, 0.6);
            padding: 1.25rem; /* 20px */
            border-radius: 0.625rem; /* 10px */
            max-width: 60rem; /* 960px */
            box-sizing: border-box;
            user-select: none;
        }

        .perfil {
            position: relative;
            text-align: center;
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            border-radius: 0.75rem; /* 12px */
            padding: 0.3125rem; /* 5px */
            user-select: none;
        }
        .perfil:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0.9375rem 0.1875rem var(--cor-accent); /* 15px 3px */
        }

        .perfil-img {
            width: 7.5rem; /* 120px */
            height: 7.5rem; /* 120px */
            object-fit: cover;
            border-radius: 50%;
            border: 0.1875rem solid var(--cor-accent); /* 3px */
            display: block;
            margin: 0 auto;
            user-select: none;
        }

        .perfil span {
            display: block;
            margin-top: 0.625rem; /* 10px */
            font-weight: bold;
            color: white;
            white-space: nowrap;
            user-select: none;
        }

        .perfil.adicionar {
            font-size: 3.75rem; /* 60px */
            color: white;
            width: 7.5rem; /* 120px */
            height: 7.5rem; /* 120px */
            border-radius: 50%;
            border: 0.125rem dashed #ccc; /* 2px */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, transform 0.3s ease;
            user-select: none;
        }
        .perfil.adicionar:hover {
            background-color: #333;
            transform: scale(1.1);
        }

        #telaPerfis button {
            background-color: var(--cor-accent);
            color: white;
            padding: 0.625rem 1.875rem; /* 10px 30px */
            border-radius: 0.3125rem; /* 5px */
            border: none;
            cursor: pointer;
            font-size: 1rem; /* 16px */
            margin-top: 1.875rem; /* 30px */
            transition: background-color 0.3s ease;
            min-height: 3rem; /* Altura mínima para toque */
        }
        #telaPerfis button:hover {
            background-color: var(--cor-accent-hover);
        }


        /* MODAL */
        #modalFundo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 110;
            user-select: none;
            animation: fadeIn 0.3s ease forwards;
        }
        #modalFundo.ativo {
            display: flex;
        }

        #modal {
            background: #111;
            padding: 1.875rem; /* 30px */
            border-radius: 0.625rem; /* 10px */
            text-align: center;
            min-width: 18.75rem; /* 300px */
            box-shadow: 0 0 1.25rem 0.1875rem var(--cor-accent); /* 20px 3px */
            animation: slideDown 0.3s ease forwards;
            user-select: none;
            position: relative;
        }

        #modal h2 {
            margin-bottom: 1.25rem; /* 20px */
            user-select: none;
        }
        #modal input[type="text"], #modal input[type="file"] {
            padding: 0.5rem; /* 8px */
            width: 90%;
            border: none;
            border-radius: 0.3125rem; /* 5px */
            font-size: 0.9375rem; /* 15px */
            outline-offset: 0.125rem; /* 2px */
            outline-color: var(--cor-accent);
            background-color: #222;
            color: white;
            margin: 0.625rem 0; /* 10px */
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        input[type="text"]:focus, input[type="file"]:focus {
            outline-color: #ff4444;
        }

        #modal button {
            background-color: var(--cor-accent);
            color: white;
            padding: 0.5rem 1.25rem; /* 8px 20px */
            border: none;
            border-radius: 0.3125rem; /* 5px */
            margin: 0.5rem 0.625rem 0 0.625rem; /* 8px 10px 0 10px */
            cursor: pointer;
            transition: background-color 0.3s ease;
            user-select: none;
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        #modal button:hover {
            background-color: var(--cor-accent-hover);
        }
        #modal button:disabled {
            background-color: var(--cor-accent-disabled);
            cursor: default;
        }

        /* ÍCONES DE EDIÇÃO/EXCLUSÃO DE PERFIL */
        .editar-icon, .excluir-icon {
            position: absolute;
            top: 0.3125rem; /* 5px */
            background-color: rgba(255, 0, 0, 0.6);
            border-radius: 50%;
            width: 1.375rem; /* 22px */
            height: 1.375rem; /* 22px */
            color: white;
            font-size: 1rem; /* 16px */
            line-height: 1.375rem; /* 22px */
            text-align: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
            user-select: none;
            z-index: 2;
            min-width: 1.875rem; /* 30px */ /* Aumentado para toque */
            min-height: 1.875rem; /* 30px */ /* Aumentado para toque */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .editar-icon { right: 0.3125rem; /* 5px */ }
        .excluir-icon { left: 0.3125rem; /* 5px */ background-color: rgba(255, 0, 0, 0.7); }
        .perfil:hover .editar-icon, .perfil:hover .excluir-icon { opacity: 0.7; }
        .editar-icon:hover, .excluir-icon:hover { opacity: 1; }

        /* TELA DE PERFIL SELECIONADO (Não mais usada na navegação principal) */
        #perfilSelecionado {
            display: none;
        }

        /* ESTILOS DO SITE PRINCIPAL */
        #sitePrincipal {
            background-color: var(--cor-bg-dark); /* Fundo do site é preto */
            z-index: 70;
            align-items: flex-start; /* Alinha o conteúdo ao topo */
            padding: 0;
            min-height: 100vh;
            overflow-y: auto; /* Permite rolagem no conteúdo do site */
            position: relative; /* Essencial para o sticky funcionar dentro dela */
            scrollbar-width: none; /* Oculta a barra de rolagem no Firefox */
            -ms-overflow-style: none;  /* Oculta a barra de rolagem no IE/Edge */
        }
        #sitePrincipal::-webkit-scrollbar { /* Oculta a barra de rolagem no Chrome/Safari */
            display: none;
        }


        /* HEADER DO SITE (Fixo no topo) */
        #sitePrincipal .header-site {
            background-color: var(--cor-header-bg); /* Cinza escuro para o header */
            display: flex;
            align-items: center;
            padding: 0.9375rem 1.875rem; /* 15px 30px */
            position: sticky; /* Torna o header fixo no topo */
            top: 0;
            width: 100%;
            z-index: 50; /* Z-index para o header */
            box-shadow: 0 0.125rem 0.625rem rgba(0, 0, 0, 0.5); /* 0 2px 10px */
            height: 3.75rem; /* 60px */
            justify-content: space-between; /* Distribui os itens horizontalmente */
        }

        #sitePrincipal .header-site .logo {
            color: var(--cor-accent);
            font-size: 2rem; /* 32px */
            font-weight: bold;
            margin-right: 1.875rem; /* 30px */
            letter-spacing: 0.0625rem; /* 1px */
            flex-shrink: 0; /* Impede que o logo encolha */
        }

        #sitePrincipal .header-site nav {
            display: flex;
            gap: 1.5625rem; /* 25px */
            align-items: center;
            margin-right: auto; /* Empurra a navegação para a esquerda */
            flex-grow: 1; /* Permite que a navegação ocupe espaço */
            flex-wrap: wrap; /* Permite que os itens da navegação quebrem a linha */
        }

        #sitePrincipal .header-site nav button {
            background: none;
            border: none;
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 0.3125rem 0; /* 5px */
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        #sitePrincipal .header-site nav button:hover {
            color: #ddd;
        }
        
        /* Menu suspenso de Gênero */
        .genre-button {
            position: relative; /* Para posicionar o dropdown */
        }
        .genre-dropdown {
            display: none; /* Controlado via JS */
            position: absolute;
            top: calc(100% + 0.3125rem); /* Abaixo do botão Gênero (5px) */
            left: 0;
            background-color: rgba(0, 0, 0, 0.85); /* Fundo preto borrado e transparente */
            backdrop-filter: blur(0.5rem); /* Efeito blur (8px) */
            border-radius: 0.25rem;
            padding: 0.5rem 0;
            z-index: 1000; /* Muito alto para garantir que ele apareça sobre tudo */
            white-space: nowrap;
            min-width: 10rem; /* 160px */
            box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.7); /* 0 4px 8px */
            max-height: 18.75rem; /* 300px */
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .genre-dropdown::-webkit-scrollbar {
            display: none;
        }

        .genre-dropdown button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.5rem 1.5rem;
            color: white;
            font-weight: normal;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        .genre-dropdown button:hover {
            background-color: rgba(255,255,255,0.15); /* Fundo cinza um pouco mais claro no hover */
            color: white;
        }
        .genre-dropdown button:active {
            background-color: var(--cor-accent);
            color: white;
        }


        #sitePrincipal .header-site .search-profile-area {
            display: flex;
            align-items: center;
            gap: 0.9375rem; /* 15px */
            margin-left: auto; /* Empurra para a direita */
        }
        #sitePrincipal .header-site #searchInput {
            background-color: rgba(255, 255, 255, 0.2);
            border: 0.125rem solid var(--cor-accent); /* Borda vermelha */
            padding: 0.5rem 0.75rem; /* 8px 12px */
            border-radius: 0.25rem; /* 4px */
            color: white;
            font-size: 0.9375rem; /* 15px */
            outline: none;
            width: 9.375rem; /* 150px - Diminuído */
            transition: background-color 0.3s ease, border-color 0.3s ease;
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        #sitePrincipal .header-site #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        #sitePrincipal .header-site #searchInput:focus {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: #ff4444; /* Cor da borda ao focar */
        }

        #profileIcon {
            width: 2rem; /* 32px */
            height: 2rem; /* 32px */
            border-radius: 50%;
            background-color: var(--cor-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            object-fit: cover;
            border: 0.125rem solid white; /* 2px */
            overflow: hidden;
            min-width: 2.5rem; /* 40px */ /* Aumentado para toque */
            min-height: 2.5rem; /* 40px */ /* Aumentado para toque */
            /* margin-left: 0.9375rem; Removido para colar no canto */
        }
        #profileIcon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* MAIN CONTENT DO SITE */
        #main-site-content {
            padding: 1.875rem; /* 30px */
            width: 100%;
            max-width: 87.5rem; /* 1400px */
            margin: 0 auto;
            overflow-y: hidden; /* O main-site-content não deve rolar, o #sitePrincipal rola */
            flex-grow: 1; /* Permite que o main ocupe o espaço restante */
        }

        /* Seções de conteúdo dentro do main-site-content */
        .content-section {
            display: none; /* Escondido por padrão, controlado por JS */
            width: 100%; /* Garante que a seção ocupe a largura total */
            min-height: calc(100vh - 3.75rem - 3.75rem); /* Altura mínima: viewport - header (60px) - padding (60px) */
        }
        .content-section.active {
            display: block; /* A seção ativa é exibida */
        }


        #main-site-content h2 {
            color: white;
            font-size: 1.75rem; /* 28px */
            font-weight: bold;
            margin-bottom: 1.5625rem; /* 25px */
            text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7); /* 2px 2px 4px */
        }

        .movie-grid {
            display: grid;
            /* Alterado para cards menores, mantendo a proporção */
            grid-template-columns: repeat(auto-fill, minmax(9rem, 1fr)); /* Reduzido de 12.5rem para 9rem */
            gap: 1.875rem; /* 30px */
        }

        .movie-card {
            background-color: #1a1a1a;
            border-radius: 0.5rem; /* 8px */
            overflow: hidden;
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.5); /* 0 4px 10px */
            text-align: left;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s ease;
        }
        .movie-card:hover {
            transform: scale(1.05);
        }

        .movie-card img {
            width: 100%;
            /* Ajustado para manter a proporção com o novo minmax do grid */
            height: 13.5rem; /* Proporcional a 9rem de largura (9 * 1.5 = 13.5) */
            object-fit: cover;
            display: block;
        }

        .movie-card h3 {
            font-size: 1.2em;
            margin: 0.625rem 0.625rem 0.3125rem; /* 10px 10px 5px */
            color: white;
            font-weight: 600;
        }

        .movie-card p {
            font-size: 0.9em;
            color: #bbb;
            margin: 0 0.625rem 0.625rem; /* 0 10px 10px */
            line-height: 1.4;
        }

        .favorito-btn {
            position: absolute;
            top: 0.625rem; /* 10px */
            right: 0.625rem; /* 10px */
            background-color: rgba(0,0,0,0.7);
            padding: 0.4rem;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            color: white;
            font-size: 1.2em;
            line-height: 1;
            width: 1.875rem; /* 30px */
            height: 1.875rem; /* 30px */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }
        .movie-card:hover .favorito-btn {
            opacity: 1;
        }
        /* Cor da estrela favorita */
        .favorito-btn span.favorited {
            color: yellow;
        }
        /* Cor da estrela não favorita */
        .favorito-btn span.not-favorited {
            color: rgba(255, 255, 255, 0.6);
        }


        /* OVERLAY/MODAL DE DETALHES/PLAYER */
        /* Overlays: Controlados por opacity e visibility para transições mais suaves e evitar problemas de clique. */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(0.625rem); /* 10px */
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden; /* Inicialmente escondido, mas ocupa espaço para transição */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .details-content, .player-content, #episodiosContent {
            background-color: rgba(26, 26, 26, 0.95);
            padding: 1.875rem; /* 30px */
            border-radius: 0.75rem; /* 12px */
            max-width: 56.25rem; /* 900px */
            width: 90%;
            box-shadow: 0 0 1.25rem rgba(0, 0, 0, 0.7); /* 20px */
            overflow-y: auto;
            max-height: 90vh;
            position: relative;
            scrollbar-width: none;
            -ms-overflow-style: none;
            transform: translateY(1.25rem); /* Para animação de entrada (20px) */
            opacity: 0; /* Para animação de entrada */
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .overlay.active .details-content,
        .overlay.active .player-content,
        .overlay.active #episodiosContent {
            transform: translateY(0);
            opacity: 1;
        }

        .details-content::-webkit-scrollbar,
        .player-content::-webkit-scrollbar,
        #episodiosContent::-webkit-scrollbar {
            display: none;
        }
        
        .details-content iframe,
        .player-content iframe {
            border: none;
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 0 0.625rem rgba(0,0,0,0.5); /* 10px */
            width: 100%;
            aspect-ratio: 16 / 9; /* Garante proporção de vídeo */
            display: block;
        }
        
        .details-content h2, #episodiosContent h2 {
            font-size: 2.2em;
            font-weight: bold;
            color: white;
            margin-top: 0.9375rem; /* 15px */
            margin-bottom: 0.625rem; /* 10px */
            text-align: center; /* Centraliza o título dos episódios */
            text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7); /* 2px 2px 4px */
        }
        .details-content p {
            font-size: 1em;
            color: #ccc;
            line-height: 1.5;
            margin-bottom: 0.625rem; /* 10px */
        }
        .details-content .meta-info {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 1.25rem; /* 20px */
        }

        /* Botão Fechar em todos os overlays */
        .close-button { /* Aplica a todos os close-button */
            position: absolute;
            top: 0.9375rem; /* 15px */
            right: 0.9375rem; /* 15px */
            background-color: var(--cor-accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.875rem; /* 30px */
            height: 1.875rem; /* 30px */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            z-index: 1002;
            min-width: 2.5rem; /* 40px */ /* Aumentado para toque */
            min-height: 2.5rem; /* 40px */ /* Aumentado para toque */
        }
        .close-button:hover {
            background-color: var(--cor-accent-hover);
        }
        /* Ajuste específico para o botão "Voltar" do player para ter padding e não ser redondo */
        .player-content .back-to-details-button {
            border-radius: 0.3125rem; /* 5px */
            padding: 0.5rem 0.9375rem; /* 8px 15px */
            font-size: 1em;
            width: auto; 
            left: 0.9375rem; /* 15px */
            right: auto;
            background-color: var(--cor-accent); /* Cor de fundo vermelha */
            color: white; /* Cor do texto branca */
            min-height: 2.5rem; /* Altura mínima para toque */
        }
        /* Efeito hover para o botão Voltar */
        .player-content .back-to-details-button:hover {
            background-color: var(--cor-accent-hover);
        }


        /* Estilos para o container de carrossel de episódios */
        #episodios-carousel-wrapper {
            position: relative;
            overflow: hidden;
            padding-bottom: 0.625rem; /* 10px */
        }

        #episodios-container-horizontal {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 0 0.625rem 0.9375rem; /* 0 10px 15px */
        }

        #episodios-container-horizontal::-webkit-scrollbar {
            display: none;
        }
        #episodios-container-horizontal {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .episodio-card {
            min-width: 15rem; /* 240px */
            max-width: 15rem; /* 240px */
            background: #111;
            border-radius: 0.5rem; /* 8px */
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.6); /* 0 4px 12px */
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-bottom: 0.3125rem; /* 5px */
        }
        .episodio-card:hover {
            transform: translateY(-0.3125rem); /* -5px */
        }

        .episodio-card img {
            width: 100%;
            height: 10rem; /* 160px */
            object-fit: cover;
            display: block;
        }

        .episodio-info {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(0.3125rem); /* 5px */
            width: 100%;
            text-align: center;
            padding: 0.625rem; /* 10px */
            font-size: 0.875rem; /* 14px */
            font-weight: bold;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 0, 0, 0.8);
            border: none;
            color: white;
            font-size: 2rem;
            padding: 0.25rem 0.75rem; /* 4px 12px */
            border-radius: 0.5rem; /* 8px */
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
            min-width: 2.5rem; /* 40px */ /* Aumentado para toque */
            min-height: 2.5rem; /* 40px */ /* Aumentado para toque */
        }
        .scroll-btn:hover {
            background: var(--cor-accent-hover);
        }

        .scroll-left {
            left: 0.625rem; /* 10px */
        }

        .scroll-right {
            right: 0.625rem; /* 10px */
        }

        /* ANIMAÇÕES */
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes slideDown {
            from {transform: translateY(-1.25rem); opacity: 0;} /* -20px */
            to {transform: translateY(0); opacity: 1;}
        }

        /* RESPONSIVIDADE */
        /* Mobile (até 768px) */
        @media (max-width: 48rem) { /* 768px */
            :root {
                font-size: 14px; /* Reduz a fonte base para mobile */
            }
            #loginBox, #modal {
                width: 90%;
                min-width: unset;
                padding: 1.25rem; /* Ajustado para rem */
            }
            input[type="text"], input[type="password"] {
                width: 100%;
                padding: 0.625rem; /* Ajustado para rem */
            }
            #containerPerfis {
                gap: 0.9375rem; /* Ajustado para rem */
                padding: 0.9375rem; /* Ajustado para rem */
                max-width: 100%;
            }
            .perfil-img {
                width: 5.625rem; /* Ajustado para rem */
                height: 5.625rem; /* Ajustado para rem */
            }
            .perfil.adicionar {
                width: 5.625rem; /* Ajustado para rem */
                height: 5.625rem; /* Ajustado para rem */
                font-size: 3rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site {
                flex-direction: column;
                align-items: flex-start;
                height: auto;
                padding: 0.625rem 1.25rem; /* Ajustado para rem */
                justify-content: flex-start; /* Alinha ao início no mobile */
            }
            #sitePrincipal .header-site .logo {
                font-size: 1.75rem; /* Ajustado para rem */
                margin-right: 0;
                margin-bottom: 0.625rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site nav {
                margin-right: auto;
                width: 100%;
                justify-content: space-between;
                gap: 0.5rem; /* Ajustado para rem */
                margin-bottom: 0.625rem; /* Ajustado para rem */
                flex-wrap: wrap;
            }
            #sitePrincipal .header-site .search-profile-area {
                width: 100%;
                justify-content: flex-end; /* Alinha à direita no mobile */
                gap: 0.625rem; /* Ajustado para rem */
                margin-left: 0; /* Remove o margin-left para alinhar */
            }
            #sitePrincipal .header-site #searchInput {
                width: 100%;
                flex-grow: 1;
                border: 0.0625rem solid var(--cor-accent); /* Borda mais fina no mobile */
            }
            #profileIcon {
                flex-shrink: 0;
                width: 2rem; /* Ajustado para rem */
                height: 2rem; /* Ajustado para rem */
                min-width: 2rem; /* Garantir tamanho mínimo */
                min-height: 2rem; /* Garantir tamanho mínimo */
                margin-left: 0; /* Removido para colar no canto */
            }
            .movie-grid {
                grid-template-columns: repeat(auto-fill, minmax(8rem, 1fr)); /* Ajustado para rem */
                gap: 0.9375rem; /* Ajustado para rem */
                padding: 0 0.625rem; /* Ajustado para rem */
            }
            .movie-card img {
                height: 12rem; /* Ajustado para rem (proporcional a 8rem de largura) */
            }
            .details-content, .player-content, #episodiosContent {
                width: 95%;
                padding: 1.25rem; /* Ajustado para rem */
            }
            .details-content h2 {
                font-size: 1.8em;
            }
            .close-button {
                top: 0.3125rem; /* Ajustado para rem */
                right: 0.3125rem; /* Ajustado para rem */
                width: 1.5625rem; /* Ajustado para rem */
                height: 1.5625rem; /* Ajustado para rem */
                font-size: 1em;
                min-width: 2rem; /* Garantir tamanho mínimo */
                min-height: 2rem; /* Garantir tamanho mínimo */
            }
            #episodios-container-horizontal {
                padding: 0 0.3125rem 0.625rem; /* Ajustado para rem */
            }
            .scroll-btn {
                font-size: 1.5rem; /* Ajustado para rem */
                padding: 0.125rem 0.5rem; /* Ajustado para rem */
                min-width: 2rem; /* Garantir tamanho mínimo */
                min-height: 2rem; /* Garantir tamanho mínimo */
            }
            .scroll-left {
                left: 0.3125rem; /* Ajustado para rem */
            }
            .scroll-right {
                right: 0.3125rem; /* Ajustado para rem */
            }
        }

        /* Mobile Pequeno (até 480px) */
        @media (max-width: 30rem) { /* 480px */
            :root {
                font-size: 12px; /* Reduz ainda mais a fonte base para mobile muito pequeno */
            }
            #sitePrincipal .header-site .logo {
                font-size: 1.5rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site nav {
                justify-content: space-around;
            }
            #sitePrincipal .header-site nav button {
                font-size: 0.875rem; /* Ajustado para rem */
            }
            .movie-grid {
                grid-template-columns: 1fr;
                padding: 0 0.5rem; /* Ajustado para rem */
            }
            .movie-card img {
                height: 12rem; /* Ajustado para rem */
            }
            #main-site-content h2 {
                font-size: 1.5rem; /* Ajustado para rem */
            }
            #profileIcon span { /* Se houver um span dentro do profileIcon */
                display: none;
            }
            .episodio-card {
                min-width: 12.5rem; /* Ajustado para rem */
                max-width: 12.5rem; /* Ajustado para rem */
            }
            .episodio-card img {
                height: 7.5rem; /* Ajustado para rem */
            }
            .episodio-info {
                font-size: 0.75rem; /* Ajustado para rem */
                padding: 0.5rem; /* Ajustado para rem */
            }
        }

        /* Telas Grandes (TVs, Desktops maiores - a partir de 1200px) */
        @media (min-width: 75rem) { /* 1200px */
            :root {
                font-size: 18px; /* Aumenta a fonte base para telas grandes */
            }
            #loginBox {
                padding: 3.5rem 4.5rem; /* Ajustado para rem */
            }
            #loginBox h1 {
                font-size: 4.5rem; /* Ajustado para rem */
            }
            input[type="text"], input[type="password"] {
                width: 18.75rem; /* Ajustado para rem */
                padding: 0.75rem; /* Ajustado para rem */
                font-size: 1.125rem; /* Ajustado para rem */
            }
            #btnEntrar {
                padding: 0.75rem 2.5rem; /* Ajustado para rem */
                font-size: 1.125rem; /* Ajustado para rem */
            }
            #containerPerfis {
                gap: 2.5rem; /* Ajustado para rem */
                padding: 2.5rem; /* Ajustado para rem */
            }
            .perfil-img {
                width: 9.375rem; /* Ajustado para rem */
                height: 9.375rem; /* Ajustado para rem */
            }
            .perfil.adicionar {
                width: 9.375rem; /* Ajustado para rem */
                height: 9.375rem; /* Ajustado para rem */
                font-size: 4.5rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site {
                padding: 1.25rem 3.75rem; /* Ajustado para rem */
                height: 4.375rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site .logo {
                font-size: 2.5rem; /* Ajustado para rem */
                margin-right: 2.5rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site nav button {
                font-size: 1.125rem; /* Ajustado para rem */
            }
            #sitePrincipal .header-site #searchInput {
                width: 12.5rem; /* 200px - Diminuído para telas grandes */
                padding: 0.625rem 1rem; /* Ajustado para rem */
                font-size: 1rem; /* Ajustado para rem */
            }
            #profileIcon {
                width: 2.5rem; /* Ajustado para rem */
                height: 2.5rem; /* Ajustado para rem */
                /* margin-left: 0.9375rem; Removido para colar no canto */
            }
            #main-site-content {
                padding: 2.5rem 3.75rem; /* Ajustado para rem */
            }
            #main-site-content h2 {
                font-size: 2.25rem; /* Ajustado para rem */
                margin-bottom: 2rem; /* Ajustado para rem */
            }
            .movie-grid {
                grid-template-columns: repeat(auto-fill, minmax(10rem, 1fr)); /* Ajustado para rem */
                gap: 2.5rem; /* Ajustado para rem */
            }
            .movie-card img {
                height: 15rem; /* Ajustado para rem (proporcional a 10rem de largura) */
            }
            .movie-card h3 {
                font-size: 1.3em;
            }
            .movie-card p {
                font-size: 1em;
            }
            .details-content, .player-content, #episodiosContent {
                max-width: 68.75rem; /* Ajustado para rem */
                padding: 2.5rem; /* Ajustado para rem */
            }
            .details-content h2 {
                font-size: 2.5em;
            }
            .close-button {
                width: 2.5rem; /* Ajustado para rem */
                height: 2.5rem; /* Ajustado para rem */
                font-size: 1.5em;
            }
            .player-content .back-to-details-button {
                padding: 0.75rem 1.5rem; /* Ajustado para rem */
                font-size: 1.125rem; /* Ajustado para rem */
            }
            .episodio-card {
                min-width: 18.75rem; /* Ajustado para rem */
                max-width: 18.75rem; /* Ajustado para rem */
            }
            .episodio-card img {
                height: 12.5rem; /* Ajustado para rem */
            }
            .episodio-info {
                font-size: 1rem; /* Ajustado para rem */
            }
            .scroll-btn {
                font-size: 2.5rem; /* Ajustado para rem */
                padding: 0.3125rem 1rem; /* Ajustado para rem */
            }
        }
    </style>
</head>
<body>

<div id="telaLogin" class="tela-principal" role="main" aria-label="Tela de Login">
    <div id="loginBox">
        <h1>Xilften</h1>
        <div class="campo">
            <input type="text" id="usuario" placeholder="Login" autocomplete="username" aria-label="Login"/>
        </div>
        <div class="campo">
            <input type="password" id="senha" placeholder="Senha" autocomplete="current-password" aria-label="Senha"/>
        </div>
        <button id="btnEntrar" aria-live="polite">Entrar</button>
        <div class="erro" id="erroMsg" role="alert" aria-live="assertive"></div>
    </div>
</div>

<div id="telaPerfis" class="tela-principal" role="main" aria-label="Tela de seleção de perfis">
    <div id="containerPerfis" tabindex="0" aria-label="Lista de perfis"></div>
    <button onclick="sair()" aria-label="Voltar para a tela de login">Voltar</button>
</div>

<div id="perfilSelecionado" class="tela-principal" role="main" aria-label="Perfil selecionado">
    <img src="" alt="Foto do perfil selecionado" id="fotoPerfilSelecionado" />
    <h2 id="nomePerfilSelecionado"></h2>
    <button onclick="entrarNoSite()" style="display: none;" aria-label="Entrar no site">Entrar no Site</button>
    <button onclick="voltarPerfis()" style="display: none;" aria-label="Voltar para seleção de perfis">Voltar para Perfis</button>
</div>

<div id="sitePrincipal" class="tela-principal">
    <header class="header-site">
        <div class="logo">Xilften</div>
        <nav>
            <button onclick="showContentSection('home-section')" aria-label="Ir para a seção Início">Início</button>
            <div class="relative genre-button" id="genreButtonContainer">
                <button id="genreDropdownButton" aria-haspopup="true" aria-expanded="false">Género</button>
                <div class="genre-dropdown" id="genreDropdown" role="menu">
                    <button role="menuitem" onclick="handleGenreClick('Animação', 'animacao-section')">Animação</button>
                    <button role="menuitem" onclick="handleGenreClick('Ação', 'acao-section')">Ação</button>
                    <button role="menuitem" onclick="handleGenreClick('Aventura', 'aventura-section')">Aventura</button>
                    <button role="menuitem" onclick="handleGenreClick('Comédia', 'comedia-section')">Comédia</button>
                    <button role="menuitem" onclick="handleGenreClick('Drama', 'drama-section')">Drama</button>
                    <button role="menuitem" onclick="handleGenreClick('Ficção Científica', 'ficcao-cientifica-section')">Ficção Científica</button>
                    <button role="menuitem" onclick="handleGenreClick('Fantasia', 'fantasia-section')">Fantasia</button>
                    <button role="menuitem" onclick="handleGenreClick('Terror', 'terror-section')">Terror</button>
                    <button role="menuitem" onclick="handleGenreClick('Romance', 'romance-section')">Romance</button>
                    <button role="menuitem" onclick="handleGenreClick('Suspense', 'suspense-section')">Suspense</button>
                    <button role="menuitem" onclick="handleGenreClick('Thriller', 'thriller-section')">Thriller</button>
                    <button role="menuitem" onclick="handleGenreClick('Documentário', 'documentario-section')">Documentário</button>
                    <button role="menuitem" onclick="handleGenreClick('Guerra', 'guerra-section')">Guerra</button>
                </div>
            </div>
            <button onclick="showContentSection('series-section')" aria-label="Ir para a seção Séries">Séries</button>
            <!-- Novo botão Animes e seu dropdown -->
            <div class="relative genre-button" id="animeButtonContainer">
                <button id="animeDropdownButton" aria-haspopup="true" aria-expanded="false">Animes</button>
                <div class="genre-dropdown" id="animeDropdown" role="menu">
                    <button role="menuitem" onclick="handleGenreClick('Shounen', 'anime-shounen-section')">Shounen</button>
                    <button role="menuitem" onclick="handleGenreClick('Shoujo', 'anime-shoujo-section')">Shoujo</button>
                    <button role="menuitem" onclick="handleGenreClick('Seinen', 'anime-seinen-section')">Seinen</button>
                    <button role="menuitem" onclick="handleGenreClick('Isekai', 'anime-isekai-section')">Isekai</button>
                    <button role="menuitem" onclick="handleGenreClick('Vida Escolar', 'anime-vida-escolar-section')">Vida Escolar</button>
                    <button role="menuitem" onclick="handleGenreClick('Ação', 'anime-acao-section')">Ação</button>
                    <button role="menuitem" onclick="handleGenreClick('Comédia', 'anime-comedia-section')">Comédia</button>
                    <button role="menuitem" onclick="handleGenreClick('Fantasia', 'anime-fantasia-section')">Fantasia</button>
                    <button role="menuitem" onclick="handleGenreClick('Ficção Científica', 'anime-ficcao-cientifica-section')">Ficção Científica</button>
                    <button role="menuitem" onclick="handleGenreClick('Terror', 'anime-terror-section')">Terror</button>
                </div>
            </div>
            <!-- Botão Dorama e seu dropdown -->
            <div class="relative genre-button" id="doramaButtonContainer">
                <button id="doramaDropdownButton" aria-haspopup="true" aria-expanded="false">Dorama</button>
                <div class="genre-dropdown" id="doramaDropdown" role="menu">
                    <button role="menuitem" onclick="handleGenreClick('Romance', 'dorama-romance-section')">Romance</button>
                    <button role="menuitem" onclick="handleGenreClick('Comédia', 'dorama-comedia-section')">Comédia</button>
                    <button role="menuitem" onclick="handleGenreClick('Drama', 'dorama-drama-section')">Drama</button>
                    <button role="menuitem" onclick="handleGenreClick('Histórico', 'dorama-historico-section')">Histórico</button>
                    <button role="menuitem" onclick="handleGenreClick('Escolar', 'dorama-escolar-section')">Escolar</button>
                    <button role="menuitem" onclick="handleGenreClick('Policial', 'dorama-policial-section')">Policial</button>
                    <button role="menuitem" onclick="handleGenreClick('Suspense', 'dorama-suspense-section')">Suspense</button>
                    <button role="menuitem" onclick="handleGenreClick('Terror', 'dorama-terror-section')">Terror</button>
                    <button role="menuitem" onclick="handleGenreClick('Fantasia', 'dorama-fantasia-section')">Fantasia</button>
                    <button role="menuitem" onclick="handleGenreClick('Médico', 'dorama-medico-section')">Médico</button>
                    <button role="menuitem" onclick="handleGenreClick('Ficção Científica', 'dorama-ficcao-cientifica-section')">Ficção Científica</button>
                </div>
            </div>
            <!-- Novo botão Novela -->
            <button onclick="showContentSection('novela-section')" aria-label="Ir para a seção Novela">Novela</button>
            <button onclick="showContentSection('minha-lista-section')" aria-label="Ir para a seção Minha Lista">Minha Lista</button>
        </nav>
        <div class="search-profile-area">
            <input id="searchInput" type="text" placeholder="Buscar..." oninput="pesquisarFilmes()" aria-label="Campo de busca de filmes e séries" />
            <div id="profileIcon" onclick="voltarParaPerfisDoSite()" aria-label="Voltar para seleção de perfis"></div>
        </div>
    </header>
    <main id="main-site-content">
        <div id="home-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Adicionados Recentemente</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="acao-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Ação</h2>
            <div class="movie-grid">
            </div>
        </div>
        
        <div id="aventura-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Aventura</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="comedia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Comédia</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="drama-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Drama</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="ficcao-cientifica-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Ficção Científica</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="fantasia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Fantasia</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="terror-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Terror</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="romance-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Romance</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="suspense-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Suspense</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="thriller-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Thriller</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="documentario-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Documentário</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="guerra-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Guerra</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="animacao-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Género: Animação</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="series-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Séries</h2>
            <div class="movie-grid">
            </div>
        </div>

        <!-- Novas seções de Animes por Gênero -->
        <div id="anime-shounen-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Shounen</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-shoujo-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Shoujo</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-seinen-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Seinen</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-isekai-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Isekai</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-vida-escolar-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Vida Escolar</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-acao-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Ação</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-comedia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Comédia</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-fantasia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Fantasia</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-ficcao-cientifica-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Ficção Científica</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="anime-terror-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Anime: Terror</h2>
            <div class="movie-grid">
            </div>
        </div>


        <!-- Novas seções de Dorama por Gênero -->
        <div id="dorama-romance-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Romance</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-comedia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Comédia</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-drama-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Drama</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-historico-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Histórico</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-escolar-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Escolar</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-policial-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Policial</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-suspense-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Suspense</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-terror-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Terror</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-fantasia-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Fantasia</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-medico-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Médico</h2>
            <div class="movie-grid">
            </div>
        </div>
        <div id="dorama-ficcao-cientifica-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Dorama: Ficção Científica</h2>
            <div class="movie-grid">
            </div>
        </div>

        <!-- Nova seção de Novela -->
        <div id="novela-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Novelas</h2>
            <div class="movie-grid">
                <p class="text-gray-400 p-4 text-center w-full">Nenhuma novela encontrada.</p>
            </div>
        </div>


        <div id="minha-lista-section" class="content-section">
            <h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Minha Lista</h2>
            <div class="movie-grid">
            </div>
        </div>

        <div id="detailsOverlay" class="overlay">
            <div class="details-content">
                <button class="close-button" onclick="closeDetailsOverlay()" aria-label="Fechar detalhes">×</button>
                <div id="detailsContentArea">
                </div>
                <button class="bg-[#e50914] hover:bg-[#b20710] px-6 py-3 rounded text-white text-lg font-semibold mt-4" id="playButtonDetailsOverlay">Assistir</button>
            </div>
        </div>

        <div id="playerOverlay" class="overlay">
            <div class="player-content">
                <button class="back-to-details-button" onclick="closePlayerOverlay()" aria-label="Voltar para os detalhes ou episódios">Voltar</button>
                <div id="playerContentArea">
                </div>
            </div>
        </div>

        <div id="episodiosOverlay" class="overlay">
            <div id="episodiosContent">
                <button class="close-button" onclick="closeEpisodiosOverlay()" aria-label="Fechar episódios">×</button>
                <h2 id="episodiosTitulo"></h2>
                <div id="episodios-carousel-wrapper">
                    <button class="scroll-btn scroll-left" onclick="scrollEpisodios(-1)">‹</button>
                    <div id="episodios-container-horizontal">
                        </div>
                    <button class="scroll-btn scroll-right" onclick="scrollEpisodios(1)">›</button>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="modalFundo" aria-modal="true" role="dialog" aria-labelledby="modalTitulo" tabindex="-1">
    <div id="modal">
        <h2 id="modalTitulo">Adicionar Perfil</h2>
        <input type="text" id="inputNomePerfil" placeholder="Nome do perfil" autocomplete="off" aria-label="Nome do perfil" />
        <input type="file" id="inputFotoPerfil" accept="image/*" aria-label="Foto do perfil" />
        <div class="modal-erro" id="modalErro"></div>
        <div>
            <button id="btnSalvar">Guardar</button>
            <button onclick="fecharModal()">Cancelar</button>
        </div>
    </div>
</div>

<script>
    // --- Variáveis e Configurações do LOGIN.HTML ---
    const telaLogin = document.getElementById("telaLogin");
    const telaPerfis = document.getElementById("telaPerfis");
    const containerPerfis = document.getElementById("containerPerfis");
    const erroMsg = document.getElementById("erroMsg");
    const modalFundo = document.getElementById("modalFundo");
    const modalTitulo = document.getElementById("modalTitulo");
    const inputNomePerfil = document.getElementById("inputNomePerfil");
    const inputFotoPerfil = document.getElementById("inputFotoPerfil");
    const btnSalvar = document.getElementById("btnSalvar");
    const btnEntrar = document.getElementById("btnEntrar");
    const inputUsuario = document.getElementById("usuario");
    const inputSenha = document.getElementById("senha");
    const modalErro = document.getElementById("modalErro");

    const perfilSelecionadoDiv = document.getElementById("perfilSelecionado");
    const fotoPerfilSelecionado = document.getElementById("fotoPerfilSelecionado");
    const nomePerfilSelecionado = document.getElementById("nomePerfilSelecionado");

    const profileIcon = document.getElementById('profileIcon');
    let perfilAtualImagem = "";

    const imagemPadraoPerfil = "https://cdn-icons-png.flaticon.com/512/684/684637.png";

    const usuariosFixos = {
        "master2090": "330620Aa.",
        "assistir2002": "348761Kn.",
        "xilften2200": "905123Aa..",
        "principal90": "542718Kn."
    };

    let tentativas = 0;
    let bloqueado = false;

    let perfis = [];
    let modoEdicao = false;
    let indiceEditando = null;

    // --- Variáveis e Configurações do SITE.HTML ---
    const sitePrincipal = document.getElementById('sitePrincipal');
    const mainSiteContent = document.getElementById('main-site-content');
    
    const genreButtonContainer = document.getElementById('genreButtonContainer');
    const genreDropdownButton = document.getElementById('genreDropdownButton');
    const genreDropdown = document.getElementById('genreDropdown');
    let dropdownTimeout;

    // Novas referências para o dropdown de Animes
    const animeButtonContainer = document.getElementById('animeButtonContainer');
    const animeDropdownButton = document.getElementById('animeDropdownButton');
    const animeDropdown = document.getElementById('animeDropdown');
    let animeDropdownTimeout;

    // Novas referências para o dropdown de Dorama
    const doramaButtonContainer = document.getElementById('doramaButtonContainer');
    const doramaDropdownButton = document.getElementById('doramaDropdownButton');
    const doramaDropdown = document.getElementById('doramaDropdown');
    let doramaDropdownTimeout;

    const homeSection = document.getElementById('home-section');
    const acaoSection = document.getElementById('acao-section');
    const aventuraSection = document.getElementById('aventura-section');
    const comediaSection = document.getElementById('comedia-section');
    const ficcaoCientificaSection = document.getElementById('ficcao-cientifica-section');
    const fantasiaSection = document.getElementById('fantasia-section');
    const terrorSection = document.getElementById('terror-section');
    const romanceSection = document.getElementById('romance-section');
    const suspenseSection = document.getElementById('suspense-section');
    const thrillerSection = document.getElementById('thriller-section');
    const documentarioSection = document.getElementById('documentario-section');
    const guerraSection = document.getElementById('guerra-section');
    const animacaoSection = document.getElementById('animacao-section');
    const seriesSection = document.getElementById('series-section');
    const minhaListaSection = document.getElementById('minha-lista-section');

    // Novas seções de animes
    const animeShounenSection = document.getElementById('anime-shounen-section');
    const animeShoujoSection = document.getElementById('anime-shoujo-section');
    const animeSeinenSection = document.getElementById('anime-seinen-section');
    const animeIsekaiSection = document.getElementById('anime-isekai-section');
    const animeVidaEscolarSection = document.getElementById('anime-vida-escolar-section');
    const animeAcaoSection = document.getElementById('anime-acao-section');
    const animeComediaSection = document.getElementById('anime-comedia-section');
    const animeFantasiaSection = document.getElementById('anime-fantasia-section');
    const animeFiccaoCientificaSection = document.getElementById('anime-ficcao-cientifica-section');
    const animeTerrorSection = document.getElementById('anime-terror-section');

    // Novas seções de dorama
    const doramaRomanceSection = document.getElementById('dorama-romance-section');
    const doramaComediaSection = document.getElementById('dorama-comedia-section');
    const doramaDramaSection = document.getElementById('dorama-drama-section');
    const doramaHistoricoSection = document.getElementById('dorama-historico-section');
    const doramaEscolarSection = document.getElementById('dorama-escolar-section');
    const doramaPolicialSection = document.getElementById('dorama-policial-section');
    const doramaSuspenseSection = document.getElementById('dorama-suspense-section');
    const doramaTerrorSection = document.getElementById('dorama-terror-section');
    const doramaFantasiaSection = document.getElementById('dorama-fantasia-section');
    const doramaMedicoSection = document.getElementById('dorama-medico-section');
    const doramaFiccaoCientificaSection = document.getElementById('dorama-ficcao-cientifica-section');

    // Nova seção de novela
    const novelaSection = document.getElementById('novela-section');
    
    const detailsOverlay = document.getElementById('detailsOverlay');
    const detailsContentArea = document.getElementById('detailsContentArea');
    const playButtonDetailsOverlay = document.getElementById('playButtonDetailsOverlay'); 
    const playerOverlay = document.getElementById('playerOverlay');
    const playerContentArea = document.getElementById('playerContentArea');
    
    const episodiosOverlay = document.getElementById('episodiosOverlay');
    const episodiosContent = document.getElementById('episodiosContent');
    const episodiosTitulo = document.getElementById('episodiosTitulo');
    const episodiosContainerHorizontal = document.getElementById('episodios-container-horizontal');

    let currentDetailedItem = null;


    // --- Dados (Filmes e Séries) ---
    // Declaração única dos filmes
    const filmes = [
        {
            id: 1,
            titulo: "Thunderbolts",
            ano: "2025",
            genero: "Ação, Aventura, Ficção Científica",
            descricao: "Presos em uma armadilha mortal, uma equipa nada convencional de anti-heróis embarca numa missão perigosa...",
            imagem: "https://lumiere-a.akamaihd.net/v1/images/teaser_1sht_-_rgb_for_online_use_only_6b92ba3f.jpeg",
            trailer: "https://drive.google.com/file/d/1f6dK1VvXE0vq5_Y6n48AjbtlZ-H_7U2T/preview",
            video: "https://drive.google.com/file/d/1BcwVjP6FE1JG98n4bwEor-j6Ky78-IVN/view?usp=sharing",
            isSerie: false
        },
   
    ];

    // Declaração única das séries
    const series = [
        {
            id: 2,
            titulo: "Sandman",
            ano: "2022",
            genero: "Drama, Fantasia",
            descricao: "Sandman narra a história de Morpheus, também conhecido como Sonho, um dos Perpétuos...",
            imagem: "https://br.web.img2.acsta.net/pictures/21/09/27/13/20/1097728.jpg", /* Capa atualizada */
            trailer: "https://drive.google.com/file/d/1uUvoyg4At2IIpqbTTra4kYaOieQX5dox/preview",
            isSerie: true,
            episodios: [
                { id: 's1e1', titulo: "Episódio 1 - Sonho dos Justos", imagem: "https://kanto.legiaodosherois.com.br/w728-h381-gnw-cfill-gcc-f:fbcover/wp-content/uploads/2021/09/legiao_ZeBC9NQHV0F1.jpg.webp", video: "https://1024terabox.com/s/13GctvfeJ1Kch4e0sOQtE-A", },
                { id: 's1e2', titulo: "Episódio 2 - Anfitriões Imperfeitos", imagem: "https://blog.incoherent.net/wp-content/uploads/2022/08/vlcsnap-2022-08-07-17h42m36s995.png?w=1200", video: "https://drive.google.com/file/d/1iqYVlWi_RC0OBwN4TpAEFegnCKIcPFBS/view?usp=sharing", },
                { id: 's1e3', titulo: "Episódio 3 - Sonhe Comigo", imagem: "https://tomandlorenzo.com/wp-content/uploads/2022/08/TheSandman_Season1_00_41_27_12R-scaled.jpg", video: "https://drive.google.com/file/d/1OytwXxC4ABFD8L-uUkDHNHt8xbKiu1p6/view?usp=sharing", },
                { id: 's1e4', titulo: "Episódio 4 - Uma Esperança no Inferno", imagem: "https://tomandlorenzo.com/wp-content/uploads/2022/08/TheSandman_Season1_00_18_53_22R-scaled.jpg", video: "https://drive.google.com/file/d/15TlfKctE410YnSFO-OJe-rNtOHtqGcSd/view?usp=sharing", },
                { id: 's1e5', titulo: "Episódio 5 - Sem Parar", imagem: "https://i0.wp.com/subjectifymedia.com/wp-content/uploads/2022/09/john-dee-3.jpg?resize=1300%2C650&ssl=1", video: "https://drive.google.com/file/d/1Rp-PUXhA0nCiZKvInTjxZHReoCqWcFE_/view?usp=sharing", },
                { id: 's1e6', titulo: "Episódio 6 - O Som das Asas Dela", imagem: "https://dnm.nflximg.net/api/v6/BvVbc2Wxr2w6QuoANoSpJKEIWjQ/AAAAQY020dAlhqHUvq66zGcc6jkuP3GhCuXsr6pLjLtzraKbNBOlVLbEbNAqwvJT5ZfKesKz4lKmYZl5iOaPuQZ-ZGmo32ZjUAfrdFqJiGFp840wOx0c7-rAiycx911sAfoHcCNOM4Jvz7n4dfpBHXNWv-F32ek.jpg?r=412", video: "https://drive.google.com/file/d/1NUXrSGklAWnY7oDlIXDyAvjK1DBUcxFR/view?usp=sharing", },
                { id: 's1e7', titulo: "Episódio 7 - Casa de Bonecas", imagem: "https://cdn.mos.cms.futurecdn.net/hBPyFufsLihM8RxQRSMruH.jpg", video: "https://drive.google.com/file/d/1cfKyiRF6wFxXzF2DNvnsGllfSymIWUC6/view?usp=sharing", },
                { id: 's1e8', titulo: "Episódio 8 - Brincando de Casinha", imagem: "https://cdn.mos.cms.futurecdn.net/vbBe58kC26yMacjKhC3kCZ.jpg", video: "https://drive.google.com/file/d/1ftvfrCrR11HabdoQ38p7YBo6GfTSsf-i/view?usp=sharing", },
                { id: 's1e9', titulo: "Episódio 9 - Colecionadores", imagem: "https://www.zonanegativa.com/imagenes/2022/08/the-sandman-netflix-9.jpg", video: "https://drive.google.com/file/d/1PsdJNcCKKrMrFHc6KefUsQOLNMgAEyYJ/view?usp=sharing", },
                { id: 's1e10', titulo: "Episódio 10 - Corações Perdidos", imagem: "https://tm.ibxk.com.br/2025/07/01/01162920952024.jpg?ims=fit-in/800x500/filters:quality(70)", video: "https://drive.google.com/file/d/1vYs4M4dHnlyzQ5RovdflB_DSEvNQQ6qR/view?usp=sharing", }
            ]
        }
  
    ];

    // Declaração única dos doramas
    const doramas = [
         
    ];

    // Declaração única dos animes
    const animes = [
      
    ];

    // Declaração única das novelas (exemplo, pode ser expandido)
    const novelas = [
       
       
    ];

    // Declaração única dos itens da home (Adicionados Recentemente)
    const homeItems = [
        {
            id: 1,
            titulo: "Thunderbolts",
            ano: "2025",
            genero: "Ação, Aventura, Ficção Científica",
            descricao: "Presos em uma armadilha mortal, uma equipa nada convencional de anti-heróis embarca numa missão perigosa...",
            imagem: "https://lumiere-a.akamaihd.net/v1/images/teaser_1sht_-_rgb_for_online_use_only_6b92ba3f.jpeg",
            trailer: "https://drive.google.com/file/d/1f6dK1VvXE0vq5_Y6n48AjbtlZ-H_7U2T/preview",
            video: "https://drive.google.com/file/d/1BcwVjP6FE1JG98n4bwEor-j6Ky78-IVN/view?usp=sharing",
            isSerie: false
        },
        {
            id: 2,
            titulo: "Sandman",
            ano: "2022",
            genero: "Drama, Fantasia",
            descricao: "Sandman narra a história de Morpheus, também conhecido como Sonho, um dos Perpétuos...",
            imagem: "https://br.web.img2.acsta.net/pictures/21/09/27/13/20/1097728.jpg", /* Capa atualizada */
            trailer: "https://drive.google.com/file/d/1uUvoyg4At2IIpqbTTra4kYaOieQX5dox/preview",
            isSerie: true,
            episodios: [
                { id: 's1e1', titulo: "Episódio 1 - Sonho dos Justos", imagem: "https://kanto.legiaodosherois.com.br/w728-h381-gnw-cfill-gcc-f:fbcover/wp-content/uploads/2021/09/legiao_ZeBC9NQHV0F1.jpg.webp", video: "https://drive.google.com/file/d/1ZqASeyupoJw6IlEu0ZhjjuzR3xUNhryt/view?usp=sharing", },
                { id: 's1e2', titulo: "Episódio 2 - Anfitriões Imperfeitos", imagem: "https://blog.incoherent.net/wp-content/uploads/2022/08/vlcsnap-2022-08-07-17h42m36s995.png?w=1200", video: "https://drive.google.com/file/d/1iqYVlWi_RC0OBwN4TpAEFegnCKIcPFBS/view?usp=sharing", },
                { id: 's1e3', titulo: "Episódio 3 - Sonhe Comigo", imagem: "https://tomandlorenzo.com/wp-content/uploads/2022/08/TheSandman_Season1_00_41_27_12R-scaled.jpg", video: "https://drive.google.com/file/d/1OytwXxC4ABFD8L-uUkDHNHt8xbKiu1p6/view?usp=sharing", },
                { id: 's1e4', titulo: "Episódio 4 - Uma Esperança no Inferno", imagem: "https://tomandlorenzo.com/wp-content/uploads/2022/08/TheSandman_Season1_00_18_53_22R-scaled.jpg", video: "https://drive.google.com/file/d/15TlfKctE410YnSFO-OJe-rNtOHtqGcSd/view?usp=sharing", },
                { id: 's1e5', titulo: "Episódio 5 - Sem Parar", imagem: "https://i0.wp.com/subjectifymedia.com/wp-content/uploads/2022/09/john-dee-3.jpg?resize=1300%2C650&ssl=1", video: "https://drive.google.com/file/d/1Rp-PUXhA0nCiZKvInTjxZHReoCqWcFE_/view?usp=sharing", },
                { id: 's1e6', titulo: "Episódio 6 - O Som das Asas Dela", imagem: "https://dnm.nflximg.net/api/v6/BvVbc2Wxr2w6QuoANoSpJKEIWjQ/AAAAQY020dAlhqHUvq66zGcc6jkuP3GhCuXsr6pLjLtzraKbNBOlVLbEbNAqwvJT5ZfKesKz4lKmYZl5iOaPuQZ-ZGmo32ZjUAfrdFqJiGFp840wOx0c7-rAiycx911sAfoHcCNOM4Jvz7n4dfpBHXNWv-F32ek.jpg?r=412", video: "https://drive.google.com/file/d/1NUXrSGklAWnY7oDlIXDyAvjK1DBUcxFR/view?usp=sharing", },
                { id: 's1e7', titulo: "Episódio 7 - Casa de Bonecas", imagem: "https://cdn.mos.cms.futurecdn.net/hBPyFufsLihM8RxQRSMruH.jpg", video: "https://drive.google.com/file/d/1cfKyiRF6wFxXzF2DNvnsGllfSymIWUC6/view?usp=sharing", },
                { id: 's1e8', titulo: "Episódio 8 - Brincando de Casinha", imagem: "https://cdn.mos.cms.futurecdn.net/vbBe58kC26yMacjKhC3kCZ.jpg", video: "https://drive.google.com/file/d/1ftvfrCrR11HabdoQ38p7YBo6GfTSsf-i/view?usp=sharing", },
                { id: 's1e9', titulo: "Episódio 9 - Colecionadores", imagem: "https://www.zonanegativa.com/imagenes/2022/08/the-sandman-netflix-9.jpg", video: "https://drive.google.com/file/d/1PsdJNcCKKrMrFHc6KefUsQOLNMgAEyYJ/view?usp=sharing", },
                { id: 's1e10', titulo: "Episódio 10 - Corações Perdidos", imagem: "https://tm.ibxk.com.br/2025/07/01/01162920952024.jpg?ims=fit-in/800x500/filters:quality(70)", video: "https://drive.google.com/file/d/1vYs4M4dHnlyzQ5RovdflB_DSEvNQQ6qR/view?usp=sharing", }
            ]
        }
    ];

    // Carregar favoritos do localStorage ou iniciar vazio
    let favoritos = JSON.parse(localStorage.getItem('xilftenFavoritos')) || [];

    // --- Array combinado de todos os itens disponíveis (filmes e séries) ---
    // Usamos um Map para garantir que os itens sejam únicos por ID
    const allItemsMap = new Map();
    [...filmes, ...series, ...homeItems, ...doramas, ...animes, ...novelas].forEach(item => { // Incluindo novelas
        allItemsMap.set(item.id, item);
    });
    const allUniqueContentItems = Array.from(allItemsMap.values());


    // --- Funções Comuns para Transição de Telas ---
    function mostrarTela(telaAtivar, telaDesativar) {
        if (telaDesativar && telaDesativar.classList.contains("ativa")) {
            telaDesativar.classList.remove("ativa");
            setTimeout(() => {
                telaDesativar.style.display = 'none';
                telaDesativar.style.overflowY = 'hidden';
            }, 800);
        }

        telaAtivar.style.display = 'flex';
        setTimeout(() => {
            telaAtivar.classList.add("ativa");
            if (telaAtivar.id === 'sitePrincipal') {
                telaAtivar.style.overflowY = 'auto';
            } else {
                telaAtivar.style.overflowY = 'hidden';
            }
        }, 10);
        document.body.style.overflowY = 'hidden';
    }


    // --- Funções do LOGIN.HTML ---
    function salvarPerfisStorage() {
        localStorage.setItem("xilftenPerfis", JSON.stringify(perfis));
    }

    function carregarPerfisStorage() {
        const dados = localStorage.getItem("xilftenPerfis");
        if (dados) {
            try {
                perfis = JSON.parse(dados);
            } catch (e) {
                console.error("Erro ao carregar perfis do localStorage:", e);
                perfis = [];
            }
        }
    }

    function salvarFavoritosStorage() {
        localStorage.setItem('xilftenFavoritos', JSON.stringify(favoritos));
    }

    window.onload = () => {
        carregarPerfisStorage();
        telaLogin.style.display = 'flex';
        telaLogin.classList.add('ativa');
        inputUsuario.focus();
        
        // Adiciona listeners para o dropdown de Gênero com a sintaxe correta
        if (genreButtonContainer && genreDropdownButton && genreDropdown) {
            genreButtonContainer.addEventListener('mouseenter', () => dropdownTimeout = showDropdown(genreDropdown, genreDropdownButton, dropdownTimeout));
            genreButtonContainer.addEventListener('mouseleave', () => dropdownTimeout = hideDropdownWithDelay(genreDropdown, genreDropdownButton, dropdownTimeout));
            genreDropdown.addEventListener('mouseenter', () => clearHideDropdownTimeout(dropdownTimeout));
            genreDropdown.addEventListener('mouseleave', () => dropdownTimeout = hideDropdownWithDelay(genreDropdown, genreDropdownButton, dropdownTimeout));
        }

        // Adiciona listeners para o novo dropdown de Animes
        if (animeButtonContainer && animeDropdownButton && animeDropdown) {
            animeButtonContainer.addEventListener('mouseenter', () => animeDropdownTimeout = showDropdown(animeDropdown, animeDropdownButton, animeDropdownTimeout));
            animeButtonContainer.addEventListener('mouseleave', () => animeDropdownTimeout = hideDropdownWithDelay(animeDropdown, animeDropdownButton, animeDropdownTimeout));
            animeDropdown.addEventListener('mouseenter', () => clearHideDropdownTimeout(animeDropdownTimeout));
            animeDropdown.addEventListener('mouseleave', () => animeDropdownTimeout = hideDropdownWithDelay(animeDropdown, animeDropdownButton, animeDropdownTimeout));
        }

        // Adiciona listeners para o novo dropdown de Dorama
        if (doramaButtonContainer && doramaDropdownButton && doramaDropdown) {
            doramaButtonContainer.addEventListener('mouseenter', () => doramaDropdownTimeout = showDropdown(doramaDropdown, doramaDropdownButton, doramaDropdownTimeout));
            doramaButtonContainer.addEventListener('mouseleave', () => doramaDropdownTimeout = hideDropdownWithDelay(doramaDropdown, doramaDropdownButton, doramaDropdownTimeout));
            doramaDropdown.addEventListener('mouseenter', () => clearHideDropdownTimeout(doramaDropdownTimeout));
            doramaDropdown.addEventListener('mouseleave', () => doramaDropdownTimeout = hideDropdownWithDelay(doramaDropdown, doramaDropdownButton, doramaDropdownTimeout));
        }
        
        renderAllContentSections();
    };

    btnEntrar.addEventListener('click', login);

    function login() {
        if (bloqueado) return;

        const usuario = inputUsuario.value.trim();
        const senha = inputSenha.value.trim();

        if (!usuario) {
            erroMsg.textContent = "Digite o Login.";
            inputUsuario.focus();
            return;
        }
        if (!senha) {
            erroMsg.textContent = "Digite a Senha.";
            inputSenha.focus();
            return;
        }

        btnEntrar.disabled = true;
        erroMsg.textContent = "";

        if (usuariosFixos[usuario] === senha) {
            tentativas = 0;
            bloqueado = false;
            erroMsg.textContent = "";
            mostrarPerfis();
            mostrarTela(telaPerfis, telaLogin);
            inputUsuario.value = "";
            inputSenha.value = "";
        } else {
            tentativas++;
            if (tentativas >= 3) {
                bloqueado = true;
                erroMsg.textContent = "Muitas tentativas. Tente novamente em 1 minuto.";
                setTimeout(() => {
                    tentativas = 0;
                    bloqueado = false;
                    erroMsg.textContent = "";
                    btnEntrar.disabled = false;
                }, 60000);
            } else {
                erroMsg.textContent = `Login ou Senha inválidos. Tentativa ${tentativas} de 3.`;
            }
        }
        if (!bloqueado) {
            btnEntrar.disabled = false;
        }
    }

    function mostrarPerfis() {
        containerPerfis.innerHTML = "";

        perfis.forEach((perfil, i) => {
            const div = document.createElement("div");
            div.className = "perfil";
            div.title = perfil.nome;
            div.setAttribute("tabindex", "0");
            div.setAttribute("role", "button");
            div.setAttribute("aria-label", `Entrar no perfil ${perfil.nome}`);

            const img = document.createElement("img");
            img.className = "perfil-img";
            img.src = perfil.imagem || imagemPadraoPerfil;
            img.alt = `Foto do perfil de ${perfil.nome}`;

            const span = document.createElement("span");
            span.textContent = perfil.nome;

            const editar = document.createElement("div");
            editar.className = "editar-icon";
            editar.innerHTML = "✎";
            editar.title = "Editar perfil";
            editar.setAttribute("role", "button");
            editar.setAttribute("tabindex", "0");
            editar.setAttribute("aria-label", `Editar perfil ${perfil.nome}`);
            editar.onclick = (e) => {
                e.stopPropagation();
                abrirModal(true, i);
            };
            editar.onkeydown = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    abrirModal(true, i);
                }
            };

            const excluir = document.createElement("div");
            excluir.className = "excluir-icon";
            excluir.innerHTML = "×";
            excluir.title = "Excluir perfil";
            excluir.setAttribute("role", "button");
            excluir.setAttribute("tabindex", "0");
            excluir.setAttribute("aria-label", `Excluir perfil ${perfil.nome}`);
            excluir.onclick = (e) => {
                e.stopPropagation();
                perfis.splice(i, 1);
                salvarPerfisStorage();
                mostrarPerfis();
            };
            excluir.onkeydown = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    perfis.splice(i, 1);
                    salvarPerfisStorage();
                    mostrarPerfis();
                }
            };

            div.onclick = () => entrarNoSite(i);
            div.onkeydown = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    entrarNoSite(i);
                }
            };

            div.appendChild(img);
            div.appendChild(editar);
            div.appendChild(excluir);
            div.appendChild(span);
            containerPerfis.appendChild(div);
        });

        if (perfis.length < 8) {
            const adicionar = document.createElement("div");
            adicionar.className = "perfil adicionar";
            adicionar.textContent = "+";
            adicionar.title = "Adicionar perfil";
            adicionar.setAttribute("tabindex", "0");
            adicionar.setAttribute("role", "button");
            adicionar.setAttribute("aria-label", "Adicionar novo perfil");
            adicionar.onclick = () => abrirModal(false);
            adicionar.onkeydown = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    abrirModal(false);
                }
            };
            containerPerfis.appendChild(adicionar);
        } else {
            const aviso = document.createElement("div");
            aviso.className = "modal-erro";
            aviso.textContent = "Limite de 8 perfis atingido.";
            containerPerfis.appendChild(aviso);
        }
    }

    function abrirModal(editando = false, indice = null) {
        modoEdicao = editando;
        indiceEditando = indice;
        modalTitulo.textContent = editando ? "Editar Perfil" : "Adicionar Perfil";
        modalErro.textContent = "";
        inputNomePerfil.value = editando ? perfis[indice].nome : "";
        inputFotoPerfil.value = "";
        modalFundo.classList.add("ativo");
        inputNomePerfil.focus();
    }

    function fecharModal() {
        modalFundo.classList.remove("ativo");
        modalErro.textContent = "";
    }

    btnSalvar.addEventListener('click', () => {
        const nome = inputNomePerfil.value.trim();
        if (nome === "") {
            modalErro.textContent = "Digite um nome.";
            inputNomePerfil.focus();
            return;
        }
        if (nome.length > 20) {
            modalErro.textContent = "Nome muito longo (máx 20 caracteres).";
            inputNomePerfil.focus();
            return;
        }
        if (!modoEdicao && perfis.length >= 8) {
            modalErro.textContent = "Limite máximo de 8 perfis atingido.";
            return;
        }
        btnSalvar.disabled = true;
        btnSalvar.textContent = "A Guardar...";

        const processarSalvar = (imagem) => {
            if (modoEdicao) {
                perfis[indiceEditando].nome = nome;
                if (imagem) perfis[indiceEditando].imagem = imagem;
            } else {
                perfis.push({ nome, imagem: imagem || imagemPadraoPerfil });
            }
            salvarPerfisStorage();
            mostrarPerfis();
            fecharModal();
            btnSalvar.disabled = false;
            btnSalvar.textContent = "Guardar";
        };

        if (inputFotoPerfil.files.length > 0) {
            const file = inputFotoPerfil.files[0];
            if (file.size > 2 * 1024 * 1024) {
                modalErro.textContent = "Imagem muito grande (máx 2MB).";
                btnSalvar.disabled = false;
                btnSalvar.textContent = "Guardar";
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                processarSalvar(e.target.result);
            };
            reader.readAsDataURL(file);
        } else {
            processarSalvar(null);
        }
    });

    function sair() {
        mostrarTela(telaLogin, telaPerfis);
        sitePrincipal.classList.remove("ativa");
        perfilSelecionadoDiv.classList.remove("ativa");

        inputUsuario.value = "";
        inputSenha.value = "";
        erroMsg.textContent = "";
        inputUsuario.focus();
    }

    function entrarNoSite(perfilIndex) {
        const perfil = perfis[perfilIndex];
        if (!perfil) return;

        perfilAtualImagem = perfil.imagem || imagemPadraoPerfil;
        updateProfileIcon();

        mostrarTela(sitePrincipal, telaPerfis);
        showContentSection('home-section');
    }

    function voltarParaPerfisDoSite() {
        closeAllOverlays();
        showContentSection('home-section');
        mostrarTela(telaPerfis, sitePrincipal);
    }

    function updateProfileIcon() {
        if (profileIcon) {
            if (perfilAtualImagem) {
                profileIcon.innerHTML = `<img src="${perfilAtualImagem}" alt="Perfil">`;
            } else {
                profileIcon.innerHTML = `P`;
            }
        }
    }

    modalFundo.addEventListener("click", e => {
        if (e.target === modalFundo) fecharModal();
    });

    inputNomePerfil.addEventListener("keydown", e => {
        if (e.key === "Enter") btnSalvar.click();
    });

    inputSenha.addEventListener("keydown", e => {
        if (e.key === "Enter") btnEntrar.click();
    });
    inputUsuario.addEventListener("keydown", e => {
        if (e.key === "Enter") inputSenha.focus();
    });

    // --- Funções do SITE.HTML ---

    function showContentSection(sectionId) {
        document.querySelectorAll('#main-site-content .content-section').forEach(section => {
            section.classList.remove('active');
        });
        const activeSection = document.getElementById(sectionId);
        if (activeSection) {
            activeSection.classList.add('active');
            mainSiteContent.scrollTop = 0;
        }
    }

    function renderAllContentSections() {
        // Agora 'allUniqueContentItems' é a fonte principal de dados para evitar duplicações
        
        const homeGrid = homeSection.querySelector('.movie-grid');
        homeGrid.innerHTML = homeItems.map(renderCard).join('');

        const allGenres = [
            'Animação', 'Ação', 'Aventura', 'Comédia', 'Drama', 'Ficção Científica', 'Fantasia',
            'Terror', 'Romance', 'Suspense', 'Thriller', 'Documentário', 'Guerra'
        ];
        allGenres.forEach(genre => {
            const genreSectionId = `${genre.toLowerCase().replace(/ /g, '-')}-section`;
            const genreSection = document.getElementById(genreSectionId);
            if (genreSection) {
                const genreGrid = genreSection.querySelector('.movie-grid');
                let filteredContent = [];

                // IDs de doramas, animes e novelas a serem excluídos das seções de gênero "gerais"
                filteredContent = allUniqueContentItems.filter(item => 
                    item.genero.includes(genre) && !item.isDorama && !item.isAnime && !item.isNovela
                );

                let contentHtml = '';
                if (filteredContent.length > 0) {
                    contentHtml += filteredContent.map(renderCard).join('');
                }
                if (contentHtml === '') {
                    contentHtml = `<p class="text-gray-400 p-4 text-center w-full">Nenhum título encontrado para este género.</p>`;
                }
                genreGrid.innerHTML = contentHtml;
            }
        });

        renderSeriesSection(); 
        renderMinhaListaSection();

        // Renderiza as seções de animes
        const animeGenres = ['Shounen', 'Shoujo', 'Seinen', 'Isekai', 'Vida Escolar', 'Ação', 'Comédia', 'Fantasia', 'Ficção Científica', 'Terror'];
        animeGenres.forEach(genre => {
            const animeGenreSectionId = `anime-${genre.toLowerCase().replace(/ /g, '-')}-section`;
            const animeGenreSection = document.getElementById(animeGenreSectionId);
            if (animeGenreSection) {
                const animeGenreGrid = animeGenreSection.querySelector('.movie-grid');
                const filteredContent = allUniqueContentItems.filter(item =>
                    item.genero.includes(genre) && item.isAnime // Filtra apenas animes para seções de anime
                );
                let contentHtml = '';
                if (filteredContent.length > 0) {
                    contentHtml += filteredContent.map(renderCard).join('');
                }
                if (contentHtml === '') {
                    contentHtml = `<p class="text-gray-400 p-4 text-center w-full">Nenhum título encontrado para este género de Anime.</p>`;
                }
                animeGenreGrid.innerHTML = contentHtml;
            }
        });

        // Renderiza as seções de dorama
        const doramaGenres = ['Romance', 'Comédia', 'Drama', 'Histórico', 'Escolar', 'Policial', 'Suspense', 'Terror', 'Fantasia', 'Médico', 'Ficção Científica'];
        doramaGenres.forEach(genre => {
            const doramaGenreSectionId = `dorama-${genre.toLowerCase().replace(/ /g, '-')}-section`;
            const doramaGenreSection = document.getElementById(doramaGenreSectionId);
            if (doramaGenreSection) {
                const doramaGenreGrid = doramaGenreSection.querySelector('.movie-grid');
                const filteredContent = allUniqueContentItems.filter(item =>
                    item.genero.includes(genre) && item.isDorama // Filtra apenas doramas para seções de dorama
                );
                let contentHtml = '';
                if (filteredContent.length > 0) {
                    contentHtml += filteredContent.map(renderCard).join('');
                }
                if (contentHtml === '') {
                    contentHtml = `<p class="text-gray-400 p-4 text-center w-full">Nenhum título encontrado para este género de Dorama.</p>`;
                }
                doramaGenreGrid.innerHTML = contentHtml;
            }
        });

        // Renderiza a seção de novelas
        const novelaGrid = novelaSection.querySelector('.movie-grid');
        const novelasToDisplay = allUniqueContentItems.filter(item => item.isNovela);
        let novelaContent = '';
        if (novelasToDisplay.length > 0) {
            novelaContent += novelasToDisplay.map(renderCard).join('');
        }
        if (novelaContent === '') {
            novelaContent = `<p class="text-gray-400 p-4 text-center w-full">Nenhuma novela encontrada.</p>`;
        }
        novelaGrid.innerHTML = novelaContent;
    }

    function renderSeriesSection() {
        const seriesGrid = seriesSection.querySelector('.movie-grid');
        // Filtra todos os doramas, animes e novelas para não aparecerem na seção Séries.
        const seriesToDisplay = allUniqueContentItems.filter(item => 
            item.isSerie && !item.isDorama && !item.isAnime && !item.isNovela
        );

        let content = '';
        if (seriesToDisplay.length > 0) {
            content += seriesToDisplay.map(renderCard).join('');
        }
        if (content === '') {
            content = `<p class="text-gray-400 p-4 text-center w-full">Nenhuma série encontrada.</p>`;
        }
        seriesGrid.innerHTML = content;
    }

    function renderMinhaListaSection() {
        const minhaListaGrid = minhaListaSection.querySelector('.movie-grid');
        // Usa allUniqueContentItems para filtrar, garantindo que não haja duplicatas
        const favoritadosToRender = allUniqueContentItems.filter(item => favoritos.includes(item.id));
        
        let minhaListaContent = '';
        if (favoritadosToRender.length > 0) {
            minhaListaContent += favoritadosToRender.map(renderCard).join('');
        }
        if (minhaListaContent === '') {
            minhaListaContent = `<p class="text-gray-400 p-4 text-center w-full">Você não tem títulos na sua lista.</p>`;
        }
        minhaListaGrid.innerHTML = minhaListaContent;
    }

    // Modificada para aceitar parâmetros para reuso
    function showDropdown(dropdownElement, buttonElement, timeoutVar) {
        clearTimeout(timeoutVar);
        if (dropdownElement) {
            dropdownElement.style.display = 'block';
            dropdownElement.style.opacity = '1';
            buttonElement.setAttribute('aria-expanded', 'true');
        }
        return timeoutVar; // Retorna o timeoutId para que possa ser armazenado
    }

    // Modificada para aceitar parâmetros para reuso
    function hideDropdown(dropdownElement, buttonElement, timeoutVar) {
        if (dropdownElement) {
            dropdownElement.style.opacity = '0';
            setTimeout(() => {
                dropdownElement.style.display = 'none';
            }, 200);
            buttonElement.setAttribute('aria-expanded', 'false');
        }
    }

    // Modificada para aceitar parâmetros para reuso
    function hideDropdownWithDelay(dropdownElement, buttonElement, timeoutVar) {
        clearTimeout(timeoutVar);
        timeoutVar = setTimeout(() => hideDropdown(dropdownElement, buttonElement, timeoutVar), 200);
        return timeoutVar; // Retorna o timeoutId para que possa ser armazenado
    }

    // Modificada para aceitar parâmetros para reuso
    function clearHideDropdownTimeout(timeoutVar) {
        clearTimeout(timeoutVar);
    }

    function handleGenreClick(genreName, sectionId) {
        showContentSection(sectionId);
        // Garante que todos os dropdowns sejam escondidos ao clicar em um gênero
        hideDropdown(genreDropdown, genreDropdownButton, dropdownTimeout); 
        hideDropdown(doramaDropdown, doramaDropdownButton, doramaDropdownTimeout);
        hideDropdown(animeDropdown, animeDropdownButton, animeDropdownTimeout); // Esconde o dropdown de Animes
    }

    function renderCard(item) {
        const isFavorited = favoritos.includes(item.id);
        const starClass = isFavorited ? 'favorited' : 'not-favorited';
        const starIcon = isFavorited ? '★' : '☆';

        return `
            <div class="movie-card" data-item-id="${item.id}" onclick="openDetailsOverlay(${item.id})" tabindex="0" role="button" aria-label="${item.titulo}, ano ${item.ano}, género ${item.genero}${item.isSerie ? ', série' : ''}">
                <div class="relative overflow-hidden rounded-xl">
                    <img src="${item.imagem}" class="w-full h-[13.5rem] object-cover rounded-t-lg" alt="Póster de ${item.titulo}" loading="lazy">
                    <div class="favorito-btn" onclick="event.stopPropagation(); toggleFavorito(${item.id})" tabindex="0" role="button" aria-label="${isFavorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                        <span class="${starClass}" aria-hidden="true">${starIcon}</span>
                    </div>
                </div>
                <h3>${item.titulo}</h3>
                <p>${item.ano} | ${item.genero}</p>
            </div>
        `;
    }

    function openDetailsOverlay(id) {
        const item = allUniqueContentItems.find(f => f.id === id); // Usa allUniqueContentItems para encontrar o item
        if (!item) return;

        currentDetailedItem = item;

        // Adicionando referrerpolicy="no-referrer-when-downgrade" como fallback para Google Drive embeds.
        // O allowfullscreen já está presente, então não precisa adicionar de novo.
        detailsContentArea.innerHTML = `
            <div class="aspect-video mb-4">
                <iframe src="${item.trailer}" allow="autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" referrerpolicy="no-referrer-when-downgrade" allowfullscreen class="w-full h-full rounded-xl" title="Trailer de ${item.titulo}" allow="autoplay"></iframe>
            </div>
            <h2>${item.titulo}</h2>
            <p class="meta-info">${item.ano} | ${item.genero}</p>
            <p>${item.descricao}</p>
        `;
        
        if (item.isSerie) {
            playButtonDetailsOverlay.textContent = "Ver Episódios";
            playButtonDetailsOverlay.onclick = () => openEpisodiosOverlay(item.id);
            playButtonDetailsOverlay.setAttribute('aria-label', `Ver episódios de ${item.titulo}`);
        } else {
            playButtonDetailsOverlay.textContent = "Assistir";
            playButtonDetailsOverlay.onclick = () => openPlayerOverlay(item.id);
            playButtonDetailsOverlay.setAttribute('aria-label', `Assistir ao filme ${item.titulo}`);
        }

        detailsOverlay.classList.add('active');
        sitePrincipal.style.overflowY = 'hidden';
    }

    function closeDetailsOverlay() {
        detailsOverlay.classList.remove('active');
        const iframe = detailsContentArea.querySelector('iframe');
        if (iframe) iframe.src = "";
        
        if (!playerOverlay.classList.contains('active') && !episodiosOverlay.classList.contains('active')) {
            sitePrincipal.style.overflowY = 'auto';
        }
    }

    function openPlayerOverlay(id) {
        let itemToPlay = null;

        // Procura o item na lista unificada de conteúdo
        const foundMainItem = allUniqueContentItems.find(item => item.id === id);

        if (foundMainItem) {
            if (foundMainItem.isSerie && foundMainItem.episodios) {
                // Se o ID é de uma série, mas a chamada é para um episódio específico (ex: clicou num card de episódio)
                const episodeFound = foundMainItem.episodios.find(ep => ep.id === id);
                if (episodeFound) {
                    itemToPlay = episodeFound; // É um episódio
                } else {
                    // Se o ID é da série, mas não é um ID de episódio específico, reproduz o primeiro episódio
                    if (foundMainItem.episodios.length > 0) {
                        itemToPlay = foundMainItem.episodios[0];
                    } else {
                        console.error("Nenhum episódio encontrado para esta série:", foundMainItem);
                        return;
                    }
                }
            } else {
                // É um filme
                itemToPlay = foundMainItem;
            }
        } else {
            // Se o ID não é de um item principal, tenta encontrar um episódio dentro do currentDetailedItem
            if (currentDetailedItem && currentDetailedItem.isSerie && currentDetailedItem.episodios) {
                const episodeFromDetailed = currentDetailedItem.episodios.find(ep => ep.id === id);
                if (episodeFromDetailed) {
                    itemToPlay = episodeFromDetailed;
                }
            }
        }

        if (!itemToPlay || !itemToPlay.video) {
            console.error("Filme/Série/Episódio não encontrado ou URL de vídeo faltando para o ID:", id, itemToPlay);
            return;
        }
        
        playerContentArea.innerHTML = `
            <iframe src="${itemToPlay.video}" allow="autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" referrerpolicy="no-referrer-when-downgrade" allowfullscreen class="w-full h-full rounded-xl" title="Player de ${itemToPlay.titulo}" allow="autoplay"></iframe>
        `;
        playerOverlay.classList.add('active');
        detailsOverlay.classList.remove('active');
        episodiosOverlay.classList.remove('active');
        sitePrincipal.style.overflowY = 'hidden';
    }

    function closePlayerOverlay() {
        playerOverlay.classList.remove('active');
        const iframe = playerContentArea.querySelector('iframe');
        if (iframe) iframe.src = "";

        if (currentDetailedItem && currentDetailedItem.isSerie) {
            episodiosOverlay.classList.add('active');
        } else {
            detailsOverlay.classList.add('active');
        }
    }

    function scrollEpisodios(dir) {
        episodiosContainerHorizontal.scrollBy({ left: dir * 300, behavior: "smooth" });
    }

    function openEpisodiosOverlay(serieId) {
        const serie = allUniqueContentItems.find(item => item.id === serieId && item.isSerie); // Busca na lista única
        if (!serie || !serie.isSerie || !serie.episodios) {
            console.error("Série ou episódios não encontrados para o ID:", serieId);
            return;
        }

        currentDetailedItem = serie;

        episodiosTitulo.textContent = `Episódios de ${serie.titulo}`;
        episodiosContainerHorizontal.innerHTML = '';

        serie.episodios.forEach(episodio => {
            const episodioDiv = document.createElement('div');
            episodioDiv.className = 'episodio-card';
            episodioDiv.innerHTML = `
                <img src="${episodio.imagem}" alt="${episodio.titulo}" loading="lazy">
                <div class="episodio-info">${episodio.titulo}</div>
            `;
            episodioDiv.setAttribute('data-episodio-id', episodio.id);
            episodioDiv.setAttribute('tabindex', '0');
            episodioDiv.setAttribute('role', 'button');
            episodioDiv.setAttribute('aria-label', `Assistir ${episodio.titulo}`);
            episodioDiv.onclick = () => playEpisode(episodio.id); 
            episodioDiv.onkeydown = (e) => { // Adicionado para acessibilidade do teclado
                if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault();
                    playEpisode(episodio.id);
                }
            };
            episodiosContainerHorizontal.appendChild(episodioDiv);
        });

        detailsOverlay.classList.remove('active');
        episodiosOverlay.classList.add('active');
        sitePrincipal.style.overflowY = 'hidden';
    }

    function closeEpisodiosOverlay() {
        episodiosOverlay.classList.remove('active');
        if (!detailsOverlay.classList.contains('active') && !playerOverlay.classList.contains('active')) {
            sitePrincipal.style.overflowY = 'auto';
        }
    }

    function playEpisode(episodioId) {
        openPlayerOverlay(episodioId);
    }

    function toggleFavorito(id) {
        const index = favoritos.indexOf(id);
        if (index > -1) {
            favoritos.splice(index, 1); // Remove dos favoritos
        } else {
            favoritos.push(id); // Adiciona aos favoritos
        }
        salvarFavoritosStorage(); // Salva o estado atualizado no localStorage

        // Re-renderiza TODAS as seções para garantir consistência visual.
        renderAllContentSections(); 

        // Garante que a seção ativa atual permaneça visível
        const currentActiveSectionElement = document.querySelector('.content-section.active');
        if (currentActiveSectionElement) {
            showContentSection(currentActiveSectionElement.id);
        } else {
            showContentSection('home-section'); // Fallback para a home
        }
    }

    function pesquisarFilmes() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        let searchResultsSection = document.getElementById('search-results-section');

        if (!searchResultsSection) {
            searchResultsSection = document.createElement('div');
            searchResultsSection.id = 'search-results-section';
            searchResultsSection.classList.add('content-section');
            mainSiteContent.appendChild(searchResultsSection);
        }
        
        searchResultsSection.innerHTML = `<h2 style="color: white; font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5625rem; text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7);">Resultados da Pesquisa para "${searchTerm}"</h2><div class="movie-grid"></div>`;

        const searchGrid = searchResultsSection.querySelector('.movie-grid');
        
        const resultadosFilmes = allUniqueContentItems.filter(item =>
            item.titulo.toLowerCase().includes(searchTerm) ||
            item.genero.toLowerCase().includes(searchTerm) ||
            item.descricao.toLowerCase().includes(searchTerm)
        );

        let content = '';
        if (resultadosFilmes.length > 0) {
            content += resultadosFilmes.map(renderCard).join('');
        }
        if (content === '') {
            content = `<p class="text-gray-400 p-4 text-center w-full">Nenhum título encontrado para a sua pesquisa.</p>`;
        }
        searchGrid.innerHTML = content;
        showContentSection('search-results-section');
    }

    function closeAllOverlays() {
        detailsOverlay.classList.remove('active');
        playerOverlay.classList.remove('active');
        episodiosOverlay.classList.remove('active');
        // Resetar os iframes para parar a reprodução
        const detailIframe = detailsContentArea.querySelector('iframe');
        if(detailIframe) detailIframe.src = "";
        const playerIframe = playerContentArea.querySelector('iframe');
        if(playerIframe) playerIframe.src = "";

        sitePrincipal.style.overflowY = 'auto';
    }

</script>

</body>
</html>
